<%- include('../partials/header') %>
    <%- include('../partials/sidebar_admin') %>
        <%- include('../partials/navbar', { titulo: 'Gestión de Habitaciones' , icono: 'fa-bed' , usuario }) %>

            <style>
                .badge {
                    padding: 4px 8px;
                    border-radius: 4px;
                    color: white;
                    font-size: 0.85rem;
                    text-transform: capitalize;
                }

                .estado-disponible {
                    background: #27ae60;
                }

                .estado-ocupada {
                    background: #c0392b;
                }

                .estado-mantenimiento {
                    background: #f39c12;
                }


                .comodidades-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                    gap: 10px;
                    background: #f8f9fa;
                    padding: 10px;
                    border-radius: 5px;
                    border: 1px solid #ddd;
                    margin-top: 5px;
                }

                .check-item {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 0.9rem;
                    cursor: pointer;
                }

                .check-item input {
                    width: auto;
                    margin: 0;
                }


                .modal {
                    display: none;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    justify-content: center;
                    align-items: center;
                }

                .modal-content {
                    background: white;
                    padding: 25px;
                    border-radius: 8px;
                    width: 90%;
                    max-width: 600px;
                    position: relative;
                    animation: fadeIn 0.3s;
                }

                .close-modal {
                    position: absolute;
                    right: 20px;
                    top: 15px;
                    font-size: 24px;
                    cursor: pointer;
                    color: #aaa;
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            </style>

            <div class="main-content">
                <main class="content">

                    <section class="tarjetas-panel">
                        <div class="tarjeta">
                            <div class="icono-tarjeta fondo-verde"><i class="fas fa-check-circle"></i></div>
                            <div class="info-tarjeta">
                                <h3>Disponibles</h3>
                                <p>
                                    <%= stats.disponibles %>
                                </p>
                            </div>
                        </div>
                        <div class="tarjeta">
                            <div class="icono-tarjeta fondo-rojo"><i class="fas fa-times-circle"></i></div>
                            <div class="info-tarjeta">
                                <h3>Ocupadas</h3>
                                <p>
                                    <%= stats.ocupadas %>
                                </p>
                            </div>
                        </div>
                        <div class="tarjeta">
                            <div class="icono-tarjeta fondo-naranja"><i class="fas fa-tools"></i></div>
                            <div class="info-tarjeta">
                                <h3>Mantenimiento</h3>
                                <p>
                                    <%= stats.mantenimiento %>
                                </p>
                            </div>
                        </div>
                    </section>

                    <section class="agg">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;"><i class="fas fa-plus"></i> Nueva Habitación
                        </h3>
                        <form method="POST" action="/administrador/habitaciones/registrar" class="login-form">
                            <div class="form-group">
                                <label>Número / Identificador</label>
                                <input name="numero" placeholder="Ej. 101, B-05" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo</label>
                                <input name="tipo" placeholder="Ej. Matrimonial, Suite" required>
                            </div>
                            <div class="form-group">
                                <label>Precio ($)</label>
                                <input type="number" name="precio" step="0.01" placeholder="0.00" required>
                            </div>
                            <div class="form-group">
                                <label>Capacidad</label>
                                <input type="number" name="capacidad" min="1" value="2">
                            </div>
                            <div class="form-group">
                                <label>Estado Inicial</label>
                                <select name="estado">
                                    <option value="disponible">Disponible</option>
                                    <option value="ocupada">Ocupada</option>
                                    <option value="mantenimiento">Mantenimiento</option>
                                </select>
                            </div>

                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>Comodidades</label>
                                <div class="comodidades-grid">
                                    <label class="check-item"><input type="checkbox" name="tiene_wifi" checked>
                                        Wifi</label>
                                    <label class="check-item"><input type="checkbox" name="tiene_televisor" checked>
                                        TV</label>
                                    <label class="check-item"><input type="checkbox" name="tiene_aire" checked> Aire
                                        Acond.</label>
                                    <label class="check-item"><input type="checkbox" name="tiene_minibar">
                                        Minibar</label>
                                    <label class="check-item"><input type="checkbox" name="tiene_jacuzzi">
                                        Jacuzzi</label>
                                </div>
                            </div>

                            <button type="submit" style="background: #27ae60;">Guardar Habitación</button>
                        </form>
                    </section>

                    <section class="crud">
                        <h3 style="color: #34495e; border-bottom: 2px solid #eee;">Inventario de Habitaciones</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Tipo</th>
                                    <th>Precio</th>
                                    <th>Capacidad</th>
                                    <th>Estado</th>
                                    <th>Extras</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (habitaciones.length> 0) { %>
                                    <% habitaciones.forEach(h=> { %>
                                        <tr>
                                            <td><strong>
                                                    <%= h.numero %>
                                                </strong></td>
                                            <td>
                                                <%= h.tipo %>
                                            </td>
                                            <td>$<%= h.precio %>
                                            </td>
                                            <td>
                                                <%= h.capacidad %> pers.
                                            </td>
                                            <td>
                                                <span class="badge estado-<%= h.estado %>">
                                                    <%= h.estado %>
                                                </span>
                                            </td>
                                            <td style="color: #666;">
                                                <% if(h.tiene_wifi) { %><i class="fas fa-wifi" title="Wifi"></i>
                                                    <% } %>
                                                        <% if(h.tiene_televisor) { %><i class="fas fa-tv"
                                                                title="TV"></i>
                                                            <% } %>
                                                                <% if(h.tiene_aire) { %><i class="fas fa-snowflake"
                                                                        title="Aire"></i>
                                                                    <% } %>
                                                                        <% if(h.tiene_jacuzzi) { %><i
                                                                                class="fas fa-water"
                                                                                title="Jacuzzi"></i>
                                                                            <% } %>
                                            </td>
                                            <td>
                                                <button class="btn-sm"
                                                    style="background:none; border:none; color: #f39c12; font-size: 1.2rem; cursor: pointer;"
                                                    onclick="abrirModalEditar(this)" data-id="<%= h.id_habitacion %>"
                                                    data-numero="<%= h.numero %>" data-tipo="<%= h.tipo %>"
                                                    data-precio="<%= h.precio %>" data-capacidad="<%= h.capacidad %>"
                                                    data-estado="<%= h.estado %>" data-wifi="<%= h.tiene_wifi %>"
                                                    data-tv="<%= h.tiene_televisor %>" data-aire="<%= h.tiene_aire %>"
                                                    data-minibar="<%= h.tiene_minibar %>"
                                                    data-jacuzzi="<%= h.tiene_jacuzzi %>">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <i class="fas fa-edit"></i>
                                                </button>
                                                <a href="#" onclick="eliminarHabitacion('<%= h.id_habitacion %>')"
                                                    style="color: #c0392b; font-size: 1.2rem; margin-left: 10px;">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="7" style="text-align: center;">No hay habitaciones
                                                        registradas en este hotel.</td>
                                                </tr>
                                                <% } %>
                            </tbody>
                        </table>
                    </section>

                </main>
                <%- include('../partials/footer') %>
            </div>

            <div id="modalEditar" class="modal">
                <div class="modal-content">
                    <span class="close-modal" onclick="cerrarModal()">&times;</span>
                    <h3 style="color: #f39c12; margin-bottom: 15px;"><i class="fas fa-edit"></i> Editar Habitación</h3>

                    <form method="POST" action="/administrador/habitaciones/editar">
                        <input type="hidden" name="id_habitacion" id="edit_id">

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Número</label>
                                <input name="numero" id="edit_numero" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo</label>
                                <input name="tipo" id="edit_tipo" required>
                            </div>
                            <div class="form-group">
                                <label>Precio ($)</label>
                                <input type="number" name="precio" id="edit_precio" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Capacidad</label>
                                <input type="number" name="capacidad" id="edit_capacidad" required>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>Estado Actual</label>
                                <select name="estado" id="edit_estado" style="width: 100%; padding: 8px;">
                                    <option value="disponible">Disponible</option>
                                    <option value="ocupada">Ocupada</option>
                                    <option value="mantenimiento">Mantenimiento</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 15px;">
                            <label>Comodidades</label>
                            <div class="comodidades-grid">
                                <label class="check-item"><input type="checkbox" name="tiene_wifi" id="check_wifi">
                                    Wifi</label>
                                <label class="check-item"><input type="checkbox" name="tiene_televisor" id="check_tv">
                                    TV</label>
                                <label class="check-item"><input type="checkbox" name="tiene_aire" id="check_aire">
                                    Aire</label>
                                <label class="check-item"><input type="checkbox" name="tiene_minibar"
                                        id="check_minibar"> Minibar</label>
                                <label class="check-item"><input type="checkbox" name="tiene_jacuzzi"
                                        id="check_jacuzzi"> Jacuzzi</label>
                            </div>
                        </div>

                        <button type="submit"
                            style="width: 100%; margin-top: 20px; background: #f39c12; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer;">
                            Guardar Cambios
                        </button>
                    </form>
                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script>
                const modal = document.getElementById('modalEditar');

                function abrirModalEditar(btn) {

                    const d = btn.dataset;

                    document.getElementById('edit_id').value = d.id;
                    document.getElementById('edit_numero').value = d.numero;
                    document.getElementById('edit_tipo').value = d.tipo;
                    document.getElementById('edit_precio').value = d.precio;
                    document.getElementById('edit_capacidad').value = d.capacidad;
                    document.getElementById('edit_estado').value = d.estado;


                    document.getElementById('check_wifi').checked = (d.wifi === "1");
                    document.getElementById('check_tv').checked = (d.tv === "1");
                    document.getElementById('check_aire').checked = (d.aire === "1");
                    document.getElementById('check_minibar').checked = (d.minibar === "1");
                    document.getElementById('check_jacuzzi').checked = (d.jacuzzi === "1");

                    document.getElementById('modalEditar').style.display = 'flex';
                }
                function cerrarModal() {
                    modal.style.display = 'none';
                }

                window.onclick = function (e) { if (e.target == modal) cerrarModal(); }

                function eliminarHabitacion(id) {
                    Swal.fire({
                        title: '¿Eliminar habitación?',
                        text: "No podrás deshacer esta acción.",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Sí, eliminar'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            fetch('/administrador/habitaciones/eliminar/' + id)
                                .then(res => {
                                    if (res.ok) {
                                        Swal.fire('Eliminado', 'La habitación ha sido borrada.', 'success')
                                            .then(() => location.reload());
                                    } else {
                                        Swal.fire('Error', 'No se pudo eliminar.', 'error');
                                    }
                                });
                        }
                    })
                }
            </script>