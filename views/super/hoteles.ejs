<%- include('../partials/header') %>

  <%- include('../partials/sidebar_super') %>
    <%- include('../partials/navbar', { titulo: 'Gestión de Hoteles' , icono: 'fa-hotel' , usuario }) %>

      <div class="main-content">
        <main class="content">

          <section class="tarjetas-panel">
            <div class="tarjeta">
              <div class="icono-tarjeta fondo-azul">
                <i class="fas fa-building"></i>
              </div>
              <div class="info-tarjeta">
                <h3>Hoteles Registrados</h3>
                <p>
                  <%= hoteles.length %>
                </p>
              </div>
            </div>
          </section>

          <section class="agg">
            <form method="POST" action="/super/hoteles/registrar" autocomplete="off" class="login-form">
              <div class="form-group">
                <label><i class="fas fa-hotel"></i> Nombre del Hotel</label>
                <input type="text" name="nombre" placeholder="Ej. Hotel Olimpos" required>
              </div>

              <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> Dirección</label>
                <input type="text" name="direccion" placeholder="Ubicación exacta" required>
              </div>

              <div class="form-group">
                <label><i class="fas fa-phone"></i> Teléfono</label>
                <input type="text" name="telefono" placeholder="+58..." required>
              </div>

              <div class="form-group">
                <label><i class="fas fa-envelope"></i> Correo Electrónico</label>
                <input type="email" name="email" placeholder="contacto@hotel.com" required>
              </div>

              <div class="form-group">
                <label><i class="far fa-calendar-alt"></i> Fecha de Registro</label>
                <input type="date" name="fecha_registro" required>
              </div>

              <button type="submit" id="btnAgregarUsuario">Registrar Hotel <i class="fa fa-save"></i></button>
            </form>
          </section>

          <section class="crud">
            <h3>Listado de Hoteles</h3>
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Dirección</th>
                  <th>Teléfono</th>
                  <th>Email</th>
                  <th>Fecha</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <% if (hoteles.length> 0) { %>
                  <% hoteles.forEach(h=> { %>
                    <tr>
                      <td>
                        <%= h.id_hotel %>
                      </td>
                      <td>
                        <%= h.nombre %>
                      </td>
                      <td>
                        <%= h.direccion %>
                      </td>
                      <td>
                        <%= h.telefono %>
                      </td>
                      <td>
                        <%= h.email %>
                      </td>
                      <td>
                        <%= new Date(h.fecha_registro).toLocaleDateString() %>
                      </td>
                      <td>
                        <a href="/super/gestion-hotel/<%= h.id_hotel %>" class="fa fa-cogs" title="Gestión Avanzada"
                          style="color: #3498db; font-size: 1.2rem; margin-right: 10px; text-decoration: none;"></a>

                        <a href="#" onclick="eliminarHotel('<%= h.id_hotel %>')" class="fa fa-trash" title="Eliminar"
                          style="color: #e74c3c; font-size: 1.2rem; text-decoration: none;"></a>
                      </td>
                    </tr>
                    <% }) %>
                      <% } else { %>
                        <tr>
                          <td colspan="7" style="text-align: center;">No hay hoteles registrados.</td>
                        </tr>
                        <% } %>
              </tbody>
            </table>
          </section>
        </main>

        <%- include('../partials/footer') %>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        function eliminarHotel(id) {
          Swal.fire({
            title: '¿Estás seguro?',
            text: "¡No podrás revertir esto! Se eliminarán las habitaciones y usuarios asociados.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {

              fetch('/super/eliminarHotel/' + id)
                .then(response => {
                  if (response.ok) {
                    Swal.fire(
                      '¡Eliminado!',
                      'El hotel ha sido eliminado.',
                      'success'
                    ).then(() => {
                      location.reload();
                    });
                  } else {
                    Swal.fire('Error', 'No se pudo eliminar el hotel.', 'error');
                  }
                });
            }
          })
        }