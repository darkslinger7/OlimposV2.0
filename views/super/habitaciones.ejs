<%- include('../partials/header') %>
  <link rel="stylesheet" href="/css/super/usuarios.css">
  <style>
    
    .comodidades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      background: #f1f2f6;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ced4da;
    }

    .check-group {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .check-group input {
      width: auto;
    
      margin: 0;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      color: white;
      text-transform: capitalize;
      
    }

    .badge-disponible {
      background-color: #27ae60;
    }

    .badge-ocupada {
      background-color: #c0392b;
    }

    .badge-mantenimiento {
      background-color: #f39c12;
    }
  </style>

  <%- include('../partials/sidebar_super') %>
    <%- include('../partials/navbar', { titulo: 'Habitaciones' , icono: 'fa-bed' , usuario }) %>

      <div class="main-content">
        <main class="content">

          <section class="tarjetas-panel">
            <div class="tarjeta">
              <div class="icono-tarjeta fondo-azul">
                <i class="fas fa-door-open"></i>
              </div>
              <div class="info-tarjeta">
                <h3>Total Habitaciones</h3>
                <p>
                  <%= habitaciones.length %>
                </p>
              </div>
            </div>
          </section>

          <section class="agg">
            <form method="POST" action="/super/habitaciones/registrar" autocomplete="off" class="login-form">

              <div class="form-group">
                <label><i class="fas fa-building"></i> Hotel</label>
                <select name="id_hotel" required>
                  <option value="" disabled selected>Seleccione un hotel</option>
                  <% hoteles.forEach(h=> { %>
                    <option value="<%= h.id_hotel %>">
                      <%= h.nombre %>
                    </option>
                    <% }) %>
                </select>
              </div>
              <div class="form-group">
                <label><i class="fas fa-hashtag"></i> N° Habitación</label>
                <input type="text" name="numero" placeholder="Ej. A-101" required>
              </div>

              <div class="form-group">
                <label><i class="fas fa-tag"></i> Tipo</label>
                <input type="text" name="tipo" placeholder="Ej. Matrimonial, Doble">
              </div>
              <div class="form-group">
                <label><i class="fas fa-users"></i> Capacidad</label>
                <input type="number" name="capacidad" min="1" value="2">
              </div>
              <div class="form-group">
                <label><i class="fas fa-dollar-sign"></i> Precio</label>
                <input type="number" name="precio" step="0.01" placeholder="0.00" required>
              </div>

              <div class="form-group">
                <label><i class="fas fa-info-circle"></i> Estado</label>
                <select name="estado">
                  <option value="disponible">Disponible</option>
                  <option value="ocupada">Ocupada</option>
                  <option value="mantenimiento">Mantenimiento</option>
                </select>
              </div>

              <div class="form-group" style="grid-column: 1 / -1;">
                <label><i class="fas fa-star"></i> Comodidades</label>
                <div class="comodidades-grid">
                  <label class="check-group"><input type="checkbox" name="tiene_televisor"> TV</label>
                  <label class="check-group"><input type="checkbox" name="tiene_wifi"> Wifi</label>
                  <label class="check-group"><input type="checkbox" name="tiene_aire"> Aire Acond.</label>
                  <label class="check-group"><input type="checkbox" name="tiene_minibar"> Minibar</label>
                  <label class="check-group"><input type="checkbox" name="tiene_jacuzzi"> Jacuzzi</label>
                </div>
              </div>

              <button type="submit" id="btnAgregarUsuario">Registrar Habitación <i class="fa fa-save"></i></button>
            </form>
          </section>

          <section class="crud">
            <h3>Listado de Habitaciones</h3>
            <table>
              <thead>
                <tr>
                  <th>Hotel</th>
                  <th>Número</th>
                  <th>Tipo</th>
                  <th>Capacidad</th>
                  <th>Precio</th>
                  <th>Estado</th>
                  <th>Extras</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <% if (habitaciones.length> 0) { %>
                  <% habitaciones.forEach(hab=> { %>
                    <tr>
                      <td><strong>
                          <%= hab.nombre_hotel %>
                        </strong></td>
                      <td>
                        <%= hab.numero %>
                      </td>
                      <td>
                        <%= hab.tipo %>
                      </td>
                      <td>
                        <%= hab.capacidad %> pers.
                      </td>
                      <td>$<%= hab.precio %>
                      </td>
                      <td>
                        <span class="badge badge-<%= hab.estado %>">
                          <%= hab.estado %>
                        </span>
                      </td>
                      <td style="font-size: 0.85rem; color: #555;">
                        <% if(hab.tiene_wifi) { %> <i class="fas fa-wifi" title="Wifi"></i>
                          <% } %>
                            <% if(hab.tiene_televisor) { %> <i class="fas fa-tv" title="TV"></i>
                              <% } %>
                                <% if(hab.tiene_aire) { %> <i class="fas fa-snowflake" title="Aire"></i>
                                  <% } %>
                                    <% if(hab.tiene_jacuzzi) { %> <i class="fas fa-water" title="Jacuzzi"></i>
                                      <% } %>
                      </td>
                      <td>
                        <a href="#" onclick="eliminarHabitacion('<%= hab.id_habitacion %>')" class="fa fa-trash"
                          title="Eliminar" style="color: #e74c3c; font-size: 1.2rem;"></a>
                      </td>
                    </tr>
                    <% }) %>
                      <% } else { %>
                        <tr>
                          <td colspan="8" style="text-align: center;">No hay habitaciones registradas.</td>
                        </tr>
                        <% } %>
              </tbody>
            </table>
          </section>
        </main>

        <%- include('../partials/footer') %>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        function eliminarHabitacion(id) {
          Swal.fire({
            title: '¿Eliminar habitación?',
            text: "Esta acción no se puede deshacer.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {
              fetch('/super/eliminarHabitacion/' + id)
                .then(response => {
                  if (response.ok) {
                    Swal.fire('¡Eliminado!', 'La habitación ha sido eliminada.', 'success')
                      .then(() => location.reload());
                  } else {
                    Swal.fire('Error', 'Hubo un problema al eliminar.', 'error');
                  }
                });
            }
          })
        }
      </script>